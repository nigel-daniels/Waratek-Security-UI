<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Waratek Application Security</title>
    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" type="text/css" />
    <link rel="stylesheet" href="css/userguide.css" type="text/css" />
    <link rel="stylesheet" href="css/bootstrap-custom.css" type="text/css" />
    <meta name="generator" content="DocBook XSL Stylesheets V1.75.2" />
    <script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js" type="text/javascript"></script>
  </head>
  <body>

    <div class="section" title="Waratek Application Security">
      <div class="titlepage">
        <div>
          <div>
            <h2 class="title"><a id="waratek_application_security"></a>Waratek Application Security</h2>
          </div>
        </div>
      </div>
      <p>The Waratek Application Security feature provides administrators with a rule-based interface to manage and mitigate specific application security problems. The rules file allows unique security functionality to be applied on a per JVC basis. Once the JVC has been defined, a rules file can be added to its folder by the administrator. A number of rule categories exist and various restrictions can be imposed through the use of rules specific to each of the available categories.</p>
      <div class="important" title="Important">
        <table border="0" summary="Important">
          <tr>
            <td rowspan="2" align="center" valign="top" width="25">
              <img alt="[Important]" src="./images/icons//important.png" />
            </td>
            <th align="left"></th>
          </tr>
          <tr>
            <td align="left" valign="top">
              <p>This is a licensed feature, but is currently supported under the evaluation license.</p>
            </td>
          </tr>
        </table>
      </div>
      <div class="section" title="Security License">
        <div class="titlepage">
          <div>
            <div>
              <h3 class="title"><a id="security_license"></a>Security License</h3>
            </div>
          </div>
        </div>
        <p>Licenses available:</p>
        <div class="orderedlist">
          <ol class="orderedlist" type="1">
            <li class="listitem">
Evaluation
</li>
            <li class="listitem">
Default Security
</li>
            <li class="listitem">
Full Security
</li>
          </ol>
        </div>
        <div class="section" title="Evaluation License">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="evaluation_license"></a>Evaluation License</h4>
              </div>
            </div>
          </div>
          <p>This allows the user to evaluate the Waratek CloudVM for a limited time, and with a limited number of JVCs. The Waratek Application Security feature can be evaluated under this license.</p>
        </div>
        <div class="section" title="Default Security License">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="default_security_license"></a>Default Security License</h4>
              </div>
            </div>
          </div>
          <p>This allows some predefined security rules to be automatically applied on a per JVC basis. These rules are provided with the installation and cannot be altered. They’re referred to as global rules, as they apply to all JVCs.</p>
        </div>
        <div class="section" title="Full Security License">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="full_security_license"></a>Full Security License</h4>
              </div>
            </div>
          </div>
          <p>This allows the user to alter the global rules provided with the installation, combined with the option of providing rules on a per-JVC basis. These JVC specific rules can override any conflicting rules in the global rule set.</p>
        </div>
      </div>
      <div class="section" title="Configuration and Deployment">
        <div class="titlepage">
          <div>
            <div>
              <h3 class="title"><a id="configuration_and_deployment"></a>Configuration and Deployment</h3>
            </div>
          </div>
        </div>
        <p>The CloudVM dynamically manages its state in the <span class="strong"><strong>/var/lib/javad</strong></span> directory by default. This location can be overridden with the <span class="strong"><strong>com.waratek.rootdir</strong></span> system property. Each JVM and JVC on the system has a corresponding directory associated with it as illustrated below:</p>
        <pre class="screen">/var/lib/javad
`-- jvm-1
    |-- jvc-1
    |-- jvc-2
`-- jvm-2
    |-- jvc-1
    |-- jvc-2</pre>
        <div class="section" title="Global Rules ( Default and Full Security License Only )">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="global_rules_default_and_full_security_license_only"></a>Global Rules ( Default and Full Security License Only )</h4>
              </div>
            </div>
          </div>
          <pre class="screen">/var/lib/javad
`-- jvm-1
    `-- global.rules
`-- jvm-2
    `-- global.rules</pre>
          <p>
            <span class="strong">
              <strong>With Default and Full Security License:</strong>
            </span>
          </p>
          <div class="itemizedlist">
            <ul class="itemizedlist">
              <li class="listitem">
The global rules file is named global.rules and is deployed on a per-CloudVM basis in the corresponding directory: <span class="strong"><strong>/var/lib/javad/&lt;jvm-name&gt;/</strong></span>
</li>
              <li class="listitem">
If no rules file is present, a default rules file will be deployed to the CloudVM folder. This default file is shipped with the installation.
</li>
              <li class="listitem">
The rules file will be loaded each time the JVC is started.
</li>
              <li class="listitem">
These global rules are shared across all JVCs.
</li>
              <li class="listitem">
If the rules file has a syntax error, it will not load and it will not be possible to start any JVC.
</li>
            </ul>
          </div>
          <p>
            <span class="strong">
              <strong>With Full Security License:</strong>
            </span>
          </p>
          <div class="itemizedlist">
            <ul class="itemizedlist">
              <li class="listitem">
The rules file is updated by the user/administrator directly through an external editor.
</li>
              <li class="listitem">
Modified file rules can be loaded and applied while a JVC is running using the <span class="emphasis"><em>loadsecurityrules</em></span> command available through both the JMX interface and jirsh command line shell. Please refer to jirsh and JMX documentation for more details.
</li>
              <li class="listitem">
Global rules can be displayed in jirsh using the command: <span class="emphasis"><em>showglobalrules</em></span>. This will display the current content of the global.rules file. Please note that if the file has been changed, but not explicitly loaded, then the content of the file displayed may not necessarily represent the rules currently in effect. Please refer to jirsh documentation for more details.
</li>
              <li class="listitem">
If a global.rules file is removed, and the security feature is explicitly loaded, a default rules file, provided with the installation, will be written to the CloudVM folder.
</li>
            </ul>
          </div>
        </div>
        <div class="section" title="JVC-Specific Rules ( Full Security License Only )">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="jvc_specific_rules_full_security_license_only"></a>JVC-Specific Rules ( Full Security License Only )</h4>
              </div>
            </div>
          </div>
          <pre class="screen">/var/lib/javad
`-- jvm-1
    |-- jvc-1
    |   `-- jvc.rules
    |-- jvc-2
        `-- jvc.rules
`-- jvm-2
    |-- jvc-1
    |   `-- jvc.rules
    |-- jvc-2
        `-- jvc.rules</pre>
          <div class="itemizedlist">
            <ul class="itemizedlist">
              <li class="listitem">
The rules file is named jvc.rules and is deployed on a per-JVC basis in the corresponding directory: <span class="strong"><strong>/var/lib/javad/&lt;jvm-name&gt;/&lt;jvc-name&gt;/</strong></span>
</li>
              <li class="listitem">
If no rules file is present, then no specific policies will be enforced.
</li>
              <li class="listitem">
The rules file will be loaded each time the JVC is started.
</li>
              <li class="listitem">
If the rules file has a syntax error, it will not load and the JVC will not start.
</li>
              <li class="listitem">
The rules file is updated by the user/administrator directly through an external editor.
</li>
              <li class="listitem">
Modified file rules can be loaded and applied while a JVC is running using the <span class="emphasis"><em>loadsecurityrules</em></span> command available through both the JMX interface and jirsh command line shell. Please refer to jirsh and JMX documentation for more details.
</li>
              <li class="listitem">
JVC rules can be displayed in jirsh using the command: <span class="emphasis"><em>showjvcrules</em></span>. This will display the current content of the jvc.rules file.
</li>
              <li class="listitem">
Please note that if the file has been changed, but not explicitly loaded, then the content of the file displayed may not necessarily represent the rules currently in effect.  Please refer to jirsh documentation for more details.
</li>
              <li class="listitem">
If a jvc.rules file is removed, and the security feature is explicitly loaded, the behaviour will be similar to that if an empty jvc.rules file were loaded, and all rules will be disabled for the associated JVC.
</li>
              <li class="listitem">
If both global rules and JVC-specific rules exist, the global rules will only be used if a security interception is not satisfied by a rule in the JVC-specific rules.
</li>
            </ul>
          </div>
        </div>
      </div>
      <div class="section" title="File Layout">
        <div class="titlepage">
          <div>
            <div>
              <h3 class="title"><a id="file_layout"></a>File Layout</h3>
            </div>
          </div>
        </div>
        <p>The jvc.rules file layout can be summarized by the following points:</p>
        <div class="itemizedlist">
          <ul class="itemizedlist">
            <li class="listitem">
Lines starting with a # character or whitespace are ignored
</li>
            <li class="listitem">
The first non # or whitespace entry should contain a rule version definition e.g. "VERSION 1.0". This will allow the implementation to be revised or modified significantly at a later date. The version will change as rules are added or revised over time.
</li>
            <li class="listitem">
The remainder of the file should consist of a list of zero or more rules.
</li>
            <li class="listitem">
If the header is not present or any of the individual rules are invalid (wrong syntax, misspelled component, etc), then the rules will not be loaded, the JVC will not start, and the user will receive an error indicating this.
</li>
          </ul>
        </div>
        <div class="example">
          <a id="idp33876576"></a>
          <p class="title">
            <b>Example 6.2. Sample rules file</b>
          </p>
          <div class="example-contents">
            <pre class="screen"># Comments are allowed

VERSION 1.0

# File I/O Rules
file:read:/etc/passwd:suspend:warn
file:write:/etc/shadow:destroy:error

# Network I/O Rules
network:bind:www.something.com:8080:suspend:debug

# Native
native:library:/usr/lib/lib1.so;8461f8fe44b61db62dceb6cf6795e43d:greylist:

# Static Linking Rules
classlink:class:java.lang.System:shutdown:debug

# Reflection Rules
reflect:class:com.blah.MyClass:shutdown:error

# Error &amp; Exception Rules
throwable:throw:java.sql.SQLIntegrityConstraintViolationException:allow:info

# Process Forking Rules
file:exec:java:deny:info</pre>
          </div>
        </div>
        <br class="example-break" />
      </div>
      <div class="section" title="Rule Format">
        <div class="titlepage">
          <div>
            <div>
              <h3 class="title"><a id="rule_format"></a>Rule Format</h3>
            </div>
          </div>
        </div>
        <p>Each rule must be contained in one and only one line. Each rule consists of 5 components. No white space must be present within the rule. These components must be separated using the <span class="emphasis"><em>:</em></span> character. The components must appear in the following order:</p>
        <p>
          <span class="emphasis">
            <em>&lt;category&gt;:&lt;subcategory&gt;:&lt;parameter&gt;:&lt;action&gt;:&lt;loglevel&gt;</em>
          </span>
        </p>
        <div class="note" title="Note">
          <table border="0" summary="Note">
            <tr>
              <td rowspan="2" align="center" valign="top" width="25">
                <img alt="[Note]" src="./images/icons//note.png" />
              </td>
              <th align="left"></th>
            </tr>
            <tr>
              <td align="left" valign="top">
                <p>There must always be 4 separators, however, <span class="emphasis"><em>:</em></span> <span class="strong"><strong>can</strong></span> be used in the <span class="emphasis"><em>&lt;parameter&gt;</em></span> (e.g. to represent ip addresses, or host + port combinations), and will not be confused with the other 4 separators. The 5 components are detailed in the following sections.</p>
              </td>
            </tr>
          </table>
        </div>
        <div class="section" title="Category - &lt;category&gt;">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="category_lt_category_gt"></a>Category - &lt;category&gt;</h4>
              </div>
            </div>
          </div>
          <p>A valid supported <span class="emphasis"><em>&lt;category&gt;</em></span> refers to a class or a group of classes that may be deemed security sensitive and may need to be intercepted by the CloudVM. The simplest example is the <span class="emphasis"><em>file</em></span> category. Opening, reading, writing, and setting attributes associated with files may be deemed a security risk in certain contexts. Each rule that starts with the category <span class="emphasis"><em>file</em></span> intends to impose access restrictions on a particular file. Supported categories may provide rules for interceptions, settings or both. Interceptions refer to rules that instruct the CloudVM to intercept an operation attempted by the user application (running in a JVC), and to take appropriate action. Settings, on the other hand are normally configuration rules that are applied to the JVC and don’t always require any runtime operations performed by the JVC to be intercepted. The following tables summarize the supported categories:</p>
          <div class="table">
            <a id="idp33887088"></a>
            <p class="title">
              <b>Table 6.2. Categories</b>
            </p>
            <div class="table-contents">
              <table summary="Categories" border="1">
                <colgroup>
                  <col />
                  <col />
                  <col />
                </colgroup>
                <thead>
                  <tr>
                    <th align="left" valign="top">Category</th>
                    <th align="left" valign="top">Rule Keyword</th>
                    <th align="left" valign="top">Description</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td align="left" valign="top">
                      <p>File I/O</p>
                    </td>
                    <td align="left" valign="top">
                      <p>file</p>
                    </td>
                    <td align="left" valign="top">
                      <p>Intercept attempts to access a file or directory, or execute processes.</p>
                    </td>
                  </tr>
                  <tr>
                    <td align="left" valign="top">
                      <p>Network I/O</p>
                    </td>
                    <td align="left" valign="top">
                      <p>network</p>
                    </td>
                    <td align="left" valign="top">
                      <p>Intercept attempts to connect to address or port</p>
                    </td>
                  </tr>
                  <tr>
                    <td align="left" valign="top">
                      <p>Static Linking</p>
                    </td>
                    <td align="left" valign="top">
                      <p>classlink</p>
                    </td>
                    <td align="left" valign="top">
                      <p>Intercept invocation of certain methods, or writes to fields.</p>
                    </td>
                  </tr>
                  <tr>
                    <td align="left" valign="top">
                      <p>Reflection (Dynamic Linking)</p>
                    </td>
                    <td align="left" valign="top">
                      <p>reflect</p>
                    </td>
                    <td align="left" valign="top">
                      <p>Intercept reflected access to methods, fields, or classes</p>
                    </td>
                  </tr>
                  <tr>
                    <td align="left" valign="top">
                      <p>Errors &amp; Exceptions</p>
                    </td>
                    <td align="left" valign="top">
                      <p>throwable</p>
                    </td>
                    <td align="left" valign="top">
                      <p>Intercept and act on specific throwable objects being created</p>
                    </td>
                  </tr>
                  <tr>
                    <td align="left" valign="top">
                      <p>Native Library (JNI)</p>
                    </td>
                    <td align="left" valign="top">
                      <p>native</p>
                    </td>
                    <td align="left" valign="top">
                      <p>Disable native library loading, or specify library white list and/or grey list.</p>
                    </td>
                  </tr>
                  <tr>
                    <td align="left" valign="top">
                      <p>SQL</p>
                    </td>
                    <td align="left" valign="top">
                      <p>sql</p>
                    </td>
                    <td align="left" valign="top">
                      <p>Intercept certain forms of SQL parameter injection attacks.</p>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <br class="table-break" />
        </div>
        <div class="section" title="Sub-Category - &lt;subcategory&gt;">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="sub_category_lt_subcategory_gt"></a>Sub-Category - &lt;subcategory&gt;</h4>
              </div>
            </div>
          </div>
          <p>The <span class="emphasis"><em>&lt;subcategory&gt;</em></span> usually corresponds to some form of operation that may be performed by a JVC application. In the case of the file category, one of the sub-categories is write, and effectively instructs the CloudVM to intercept attempts to write to a file. The file itself is then specified by the <span class="emphasis"><em>&lt;parameter&gt;</em></span> component of the rule. The supported sub-categories will be detailed per-category later.</p>
        </div>
        <div class="section" title="Rule Parameter - &lt;parameter&gt;">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="rule_parameter_lt_parameter_gt"></a>Rule Parameter - &lt;parameter&gt;</h4>
              </div>
            </div>
          </div>
          <p>The <span class="emphasis"><em>&lt;parameter&gt;</em></span> component of the rule can be used to identify a particular resource (class, file, port number, etc.), and is tightly coupled with the <span class="emphasis"><em>&lt;subcategory&gt;</em></span>. For example, in the case of the file category, if the <span class="emphasis"><em>&lt;subcategory&gt;</em></span> indicates that write must be intercepted, then the <span class="emphasis"><em>&lt;parameter&gt;</em></span> can be used to specify the path to a particular file for which writes should be intercepted. Once intercepted, an action can be specified by the <span class="emphasis"><em>&lt;action&gt;</em></span> component of the rule.</p>
        </div>
        <div class="section" title="Mitigation Action - &lt;action&gt;">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="mitigation_action_lt_action_gt"></a>Mitigation Action - &lt;action&gt;</h4>
              </div>
            </div>
          </div>
          <p>Mitigation actions may be category dependent. The most common example is to deny a particular event, for example, port binding, package import, file access etc.
The <span class="emphasis"><em>&lt;action&gt;</em></span> component of the rule indicates what the CloudVM must do whenever the specified interception criteria are met on the basis of the first 3 components of the rule. Omitting the <span class="emphasis"><em>&lt;action&gt;</em></span> implies that the requested operation is allowed, and sometimes such a scenario is useful if one wishes to log the occurrence, but allow the application to continue executing. Some rule categories, such as native, currently do not use <span class="emphasis"><em>&lt;action&gt;</em></span> or <span class="emphasis"><em>&lt;loglevel&gt;</em></span>, but throw an UnsatisfiedLinkError when the native rule criteria are violated. The supported actions are common across most categories, and are summarized in order of most conservative to least conservative in the following table.</p>
          <div class="table">
            <a id="idp33929488"></a>
            <p class="title">
              <b>Table 6.3. Mitigation Actions</b>
            </p>
            <div class="table-contents">
              <table summary="Mitigation Actions" border="1">
                <colgroup>
                  <col />
                  <col />
                </colgroup>
                <thead>
                  <tr>
                    <th align="left" valign="top">Rule Keyword</th>
                    <th align="left" valign="top">Description</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td align="left" valign="top">
                      <p>destroy</p>
                    </td>
                    <td align="left" valign="top">
                      <p>shutdown JVC immediately</p>
                    </td>
                  </tr>
                  <tr>
                    <td align="left" valign="top">
                      <p>shutdown</p>
                    </td>
                    <td align="left" valign="top">
                      <p>shutdown JVC gracefully</p>
                    </td>
                  </tr>
                  <tr>
                    <td align="left" valign="top">
                      <p>suspend</p>
                    </td>
                    <td align="left" valign="top">
                      <p>suspend the threads of the JVC</p>
                    </td>
                  </tr>
                  <tr>
                    <td align="left" valign="top">
                      <p>deny</p>
                    </td>
                    <td align="left" valign="top">
                      <p>return false or throw exception (Not Supported by Throwable Rules)</p>
                    </td>
                  </tr>
                  <tr>
                    <td align="left" valign="top">
                      <p>greylist</p>
                    </td>
                    <td align="left" valign="top">
                      <p>greylist a native library file (Supported by Native Rules Only)</p>
                    </td>
                  </tr>
                  <tr>
                    <td align="left" valign="top">
                      <p>blacklist</p>
                    </td>
                    <td align="left" valign="top">
                      <p>blacklist a native library file (Supported by Native Rules Only)</p>
                    </td>
                  </tr>
                  <tr>
                    <td align="left" valign="top">
                      <p>whitelist</p>
                    </td>
                    <td align="left" valign="top">
                      <p>whitelist a native library file (Supported by Native Rules Only)</p>
                    </td>
                  </tr>
                  <tr>
                    <td align="left" valign="top">
                      <p>allow</p>
                    </td>
                    <td align="left" valign="top">
                      <p>return true. If no action is specified in the rule, allow is assumed</p>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <br class="table-break" />
          <div class="note" title="Note">
            <table border="0" summary="Note">
              <tr>
                <td rowspan="2" align="center" valign="top" width="25">
                  <img alt="[Note]" src="./images/icons//note.png" />
                </td>
                <th align="left"></th>
              </tr>
              <tr>
                <td align="left" valign="top">
                  <p>If a suspend action is specified, but the rule is violated before the main method of the application has been invoked, it is not possible to suspend the JVC, as it hasn’t been launched. In such cases, the behaviour will be that of the shutdown action.</p>
                </td>
              </tr>
            </table>
          </div>
        </div>
        <div class="section" title="Logging - &lt;loglevel&gt;">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="logging_lt_loglevel_gt"></a>Logging - &lt;loglevel&gt;</h4>
              </div>
            </div>
          </div>
          <p>The <span class="emphasis"><em>&lt;loglevel&gt;</em></span> component indicates the level at which to log interceptions etc. The other components of the rule are sufficient to construct a meaningful message. Omitting the <span class="emphasis"><em>&lt;loglevel&gt;</em></span> simply means that nothing will be logged if the rule is violated. The supported loglevels are common to all rules and correspond to those supported by log4j. The levels supported are ranked in order of highest to lowest in the following table:</p>
          <div class="table">
            <a id="idp33958928"></a>
            <p class="title">
              <b>Table 6.4. Log Level</b>
            </p>
            <div class="table-contents">
              <table summary="Log Level" border="1">
                <colgroup>
                  <col />
                </colgroup>
                <thead>
                  <tr>
                    <th align="left" valign="top">Log Level</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td align="left" valign="top">
                      <p>off</p>
                    </td>
                  </tr>
                  <tr>
                    <td align="left" valign="top">
                      <p>error</p>
                    </td>
                  </tr>
                  <tr>
                    <td align="left" valign="top">
                      <p>warn</p>
                    </td>
                  </tr>
                  <tr>
                    <td align="left" valign="top">
                      <p>info</p>
                    </td>
                  </tr>
                  <tr>
                    <td align="left" valign="top">
                      <p>debug</p>
                    </td>
                  </tr>
                  <tr>
                    <td align="left" valign="top">
                      <p>trace</p>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <br class="table-break" />
          <div class="note" title="NOTE">
            <table border="0" summary="Note: NOTE">
              <tr>
                <td rowspan="2" align="center" valign="top" width="25">
                  <img alt="[Note]" src="./images/icons//note.png" />
                </td>
                <th align="left">NOTE</th>
              </tr>
              <tr>
                <td align="left" valign="top">
                  <div class="itemizedlist">
                    <ul class="itemizedlist">
                      <li class="listitem">
The <span class="emphasis"><em>off</em></span> level indicates that nothing is to be logged for the rule in question. This level is assumed if the <span class="emphasis"><em>&lt;loglevel&gt;</em></span> is omitted from the rule.
</li>
                      <li class="listitem">
The severity of the log level will determine, primarily, which rule to trigger should 2 or more rules exist with the same parameter and action.
</li>
                      <li class="listitem">
The log level specified in a rule denotes how it will be annotated in the security log file. It is at the discretion of the user to decide at what level they wish to represent the violation of a particular rule. For all intents and purposes, these log levels provide a means of categorizing the severity of rule violations. The severity of certain rule violations will depend on the nature of the application.
</li>
                      <li class="listitem">
The log level can be useful to categorise expected/unexpected behaviours when auditing an application in permissive mode, using rules that have allow as their actions.
</li>
                      <li class="listitem">
All rule-based events are logged to a file on a per-JVM basis, e.g. <span class="strong"><strong>/var/log/javad/jvm-1/rules.log</strong></span>
</li>
                      <li class="listitem">
Please refer to chapter 3 for details on how logging can be configured.
</li>
                    </ul>
                  </div>
                </td>
              </tr>
            </table>
          </div>
          <div class="example">
            <a id="idp33981040"></a>
            <p class="title">
              <b>Example 6.3. Logfile Entries</b>
            </p>
            <div class="example-contents">
              <p>Each time a rule is triggered, an entry is written to the log file (unless logging is off for that rule).
Each entry consists of:</p>
              <div class="itemizedlist">
                <ul class="itemizedlist">
                  <li class="listitem">
Date
</li>
                  <li class="listitem">
Time
</li>
                  <li class="listitem">
Log Level
</li>
                  <li class="listitem">
Mitigation Action
</li>
                  <li class="listitem">
JVC Name
</li>
                  <li class="listitem">
Rule Category ( and sub-category if more than one is supported )
</li>
                  <li class="listitem">
Rule Parameter Triggered
</li>
                  <li class="listitem">
Intercepted Entity
</li>
                </ul>
              </div>
              <p>e.g.</p>
              <pre class="screen">2014-10-07 16:19:39,221 INFO  ALLOW jvc-1 ClassLink: [java.lang.*] - [java.lang.StringBuilder]
2014-10-07 16:19:39,222 INFO  ALLOW jvc-1 ClassLink: [java.io.PrintStream] - [java.io.PrintStream]</pre>
            </div>
          </div>
          <br class="example-break" />
        </div>
      </div>
      <div class="section" title="Rule Components for Specific Categories">
        <div class="titlepage">
          <div>
            <div>
              <h3 class="title"><a id="rule_components_for_specific_categories"></a>Rule Components for Specific Categories</h3>
            </div>
          </div>
        </div>
        <p>The following sections detail the rule components for each category.</p>
        <div class="section" title="File I/O - Keyword: file">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="file_i_o_keyword_file"></a>File I/O - Keyword: file</h4>
              </div>
            </div>
          </div>
          <p>File operations, such as opening for reading or writing, modifying file attributes (such as last modified dates, etc.), can be controlled. Fine-grained control is supported, such as disallowing modification of .JAR files so that Trojan classes cannot be inserted into a JAR file unknowingly. Some high-level examples of rules are:</p>
          <div class="itemizedlist">
            <ul class="itemizedlist">
              <li class="listitem">
Log a warning upon writing to any file
</li>
              <li class="listitem">
Allow/deny creating of new files in certain directories
</li>
              <li class="listitem">
Disallow writing to, or modification of, JAR files
</li>
              <li class="listitem">
Protect arbitrary files or directories from modification, such as *.rules and *.xml
</li>
              <li class="listitem">
Prohibit execution both JVCs and external processes.
</li>
            </ul>
          </div>
          <p>The following examples show how a rule might be represented in a rules file.</p>
          <div class="example">
            <a id="idp33999136"></a>
            <p class="title">
              <b>Example 6.4. File Read Rule - File Path</b>
            </p>
            <div class="example-contents">
              <p>To prohibit the JVC from reading the /etc/passwd file:</p>
              <pre class="screen">file:read:/etc/passwd:suspend:warn</pre>
              <p>If the JVC attempts to open /etc/passwd for reading, the JVC’s execution will be suspended, and a message will be logged at the <span class="emphasis"><em>warn</em></span> level indicating that the attempt was made and that the JVC has been suspended.</p>
            </div>
          </div>
          <br class="example-break" />
          <div class="example">
            <a id="idp34002176"></a>
            <p class="title">
              <b>Example 6.5. .File Write Rule - Directory Path</b>
            </p>
            <div class="example-contents">
              <p>To prohibit the JVC from writing to the /etc directory (and its sub-directories):</p>
              <pre class="screen">file:write:/etc:deny:</pre>
              <p>If the JVC attempts to write to any file or directory in /etc, the request will be denied. Note that the &lt;loglevel&gt; is empty, so nothing will be logged.</p>
            </div>
          </div>
          <br class="example-break" />
          <div class="example">
            <a id="idp34004656"></a>
            <p class="title">
              <b>Example 6.6. File Write Rule - File Name</b>
            </p>
            <div class="example-contents">
              <p>To prohibit the JVC from writing to any file of a specified name regardless of location:</p>
              <pre class="screen">file:write:somefile.txt:shutdown:error</pre>
              <p>If the JVC attempts to write to any file named <span class="emphasis"><em>somefile.txt</em></span>, the JVC will be shutdown, and a message will be logged at the <span class="emphasis"><em>error</em></span> level indicating that the attempt was made and that the JVC has been shutdown.</p>
            </div>
          </div>
          <br class="example-break" />
          <div class="example">
            <a id="idp34007872"></a>
            <p class="title">
              <b>Example 6.7. File Exec Rule - File Path</b>
            </p>
            <div class="example-contents">
              <p>To prohibit the JVC from executing a particular shell process:</p>
              <pre class="screen">file:exec:/bin/ls:deny:error</pre>
              <p>If the JVC attempts to execute (fork) the /bin/ls process, the operation will be denied, and a message will be logged at the <span class="emphasis"><em>error</em></span> level indicating that the attempt was made and that the operation was denied.</p>
            </div>
          </div>
          <br class="example-break" />
          <div class="example">
            <a id="idp34010736"></a>
            <p class="title">
              <b>Example 6.8. File Exec Rule - File Name</b>
            </p>
            <div class="example-contents">
              <p>To prohibit the JVC from executing any file on the system called <span class="emphasis"><em>pwd</em></span>:</p>
              <pre class="screen">file:exec:pwd:deny:error</pre>
              <p>If the JVC attempts to execute (fork) a process named <span class="emphasis"><em>pwd</em></span>, the operation will be denied, and a message will be logged at the <span class="emphasis"><em>error</em></span> level indicating that the attempt was made and that the operation was denied.</p>
            </div>
          </div>
          <br class="example-break" />
          <div class="example">
            <a id="idp34014304"></a>
            <p class="title">
              <b>Example 6.9. File Exec Rule - Wildcard</b>
            </p>
            <div class="example-contents">
              <p>The following rule will disable process forking:</p>
              <pre class="screen">file:exec:*:deny:error</pre>
            </div>
          </div>
          <br class="example-break" />
          <div class="example">
            <a id="idp34016080"></a>
            <p class="title">
              <b>Example 6.10. File Exec Rule - Deny Java, Allow JVC</b>
            </p>
            <div class="example-contents">
              <p>The following rule combination  will disable forking of java on the filesystem, but will allow JVCs to be spawned:</p>
              <pre class="screen">file:exec:java:deny:error
file:exec:$JVC:allow:error</pre>
              <p>Note that JVC java is distinguished from java on the filesystem through the use of a predefined variable <span class="strong"><strong>$JVC</strong></span>.</p>
              <p>When forking a java process:</p>
              <div class="itemizedlist">
                <ul class="itemizedlist">
                  <li class="listitem">
If an absolute path is not provided, a JVC will be spawned.
</li>
                  <li class="listitem">
If an absolute path is specified and it is a Waratek cartridge java executable, a JVC will be spawned.
</li>
                  <li class="listitem">
If an absolute path is specified and it is not a Waratek cartridge java executable, an external process will be spawned for the java being used (e.g. "/usr/bin/java" )
</li>
                </ul>
              </div>
            </div>
          </div>
          <br class="example-break" />
          <p><span class="strong"><strong>&lt;subcategory&gt;</strong></span>
In the case of the file category, the <span class="emphasis"><em>&lt;subcategory&gt;</em></span>, in conjunction with the <span class="emphasis"><em>&lt;parameter&gt;</em></span>, is used to specify interception criteria. The types of access that can be restricted on a file are outlined in the following table.</p>
          <div class="table">
            <a id="idp34024960"></a>
            <p class="title">
              <b>Table 6.5. File Sub-Category</b>
            </p>
            <div class="table-contents">
              <table summary="File Sub-Category" border="1">
                <colgroup>
                  <col />
                  <col />
                </colgroup>
                <thead>
                  <tr>
                    <th align="left" valign="top">Rule Keyword</th>
                    <th align="left" valign="top">Description</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td align="left" valign="top">
                      <p>read</p>
                    </td>
                    <td align="left" valign="top">
                      <p>Intercept attempts to read a file</p>
                    </td>
                  </tr>
                  <tr>
                    <td align="left" valign="top">
                      <p>write</p>
                    </td>
                    <td align="left" valign="top">
                      <p>Intercept attempts to write a file
Note that <span class="emphasis"><em>write</em></span> includes attempts to do the following:
open file for writing,
create file,
set last modified value,
set writable attribute,
etc.</p>
                    </td>
                  </tr>
                  <tr>
                    <td align="left" valign="top">
                      <p>exec</p>
                    </td>
                    <td align="left" valign="top">
                      <p>Intercept attempts to execute files on the system, effectively allowing control over process forking.</p>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <br class="table-break" />
          <p><span class="strong"><strong>&lt;parameter&gt;</strong></span>
The <span class="emphasis"><em>&lt;parameter&gt;</em></span> is a string representing a file or directory. This is common for read, write and exec operations. Specifically the following file representations can be specified. Only one path can be specified per file rule.</p>
          <div class="table">
            <a id="idp34042176"></a>
            <p class="title">
              <b>Table 6.6. File Rule Parameter</b>
            </p>
            <div class="table-contents">
              <table summary="File Rule Parameter" border="1">
                <colgroup>
                  <col />
                  <col />
                  <col />
                </colgroup>
                <thead>
                  <tr>
                    <th align="left" valign="top">&lt;parameter&gt;</th>
                    <th align="left" valign="top">Description</th>
                    <th align="left" valign="top">Example</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td align="left" valign="top">
                      <p>&lt;file&gt;</p>
                    </td>
                    <td align="left" valign="top">
                      <p>Just the filename itself. Any file matching that name will be intercepted, regardless of directory location</p>
                    </td>
                    <td align="left" valign="top">
                      <p>myfile.txt</p>
                    </td>
                  </tr>
                  <tr>
                    <td align="left" valign="top">
                      <p>&lt;path&gt;</p>
                    </td>
                    <td align="left" valign="top">
                      <p>Canonical form of file or dir path</p>
                    </td>
                    <td align="left" valign="top">
                      <p>/usr/lib/locale/locale-archive, /usr/lib</p>
                    </td>
                  </tr>
                  <tr>
                    <td align="left" valign="top">
                      <p>&lt;wc-file&gt;</p>
                    </td>
                    <td align="left" valign="top">
                      <p>Wildcard file representation. Any file matching that pattern will be intercepted, regardless of directory location</p>
                    </td>
                    <td align="left" valign="top">
                      <p>my*.txt, \*.xml, *</p>
                    </td>
                  </tr>
                  <tr>
                    <td align="left" valign="top">
                      <p>&lt;wc-path&gt;</p>
                    </td>
                    <td align="left" valign="top">
                      <p>Wildcard file. Wildcards can appear as the file prefix, at the start of the file prefix, end of the file prefix, as the file extension, start of the file extension or end of the file extension.</p>
                    </td>
                    <td align="left" valign="top">
                      <p>/usr/lib/*.so, /usr/lib/*bc.so, /usr/lib/ab*.so, /usr/lib/abc.*, /usr/lib/abc.s*, /usr/lib/abc.*o, /usr/lib/*bc.*</p>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <br class="table-break" />
          <p><span class="strong"><strong>Wildcard Support</strong></span>
Aside from wildcarding in the file name, examples of which are given in the table above, there are effectively 2 wildcard characters that, when used as a single parameter, represent all files on the file system, asterisk '*' and slash '/'. Note that these wildcard symbols are equivalent.</p>
          <div class="example">
            <a id="idp34065584"></a>
            <p class="title">
              <b>Example 6.11. File Rule - Wildcard</b>
            </p>
            <div class="example-contents">
              <p>To deny read access to all files on filesystem, any one of the following rules can be specified:</p>
              <pre class="screen">file:read:*:deny:info
file:read:/:deny:info</pre>
            </div>
          </div>
          <br class="example-break" />
          <p><span class="strong"><strong>Path Precedence</strong></span>
Path precedence is determined through path specificity. The following is a list of sample paths in decreasing order of specificity:</p>
          <pre class="screen">/tmp/directory/file.txt
/tmp/directory/*.txt
/tmp/directory
/tmp
file.txt
*.txt
/ (alternatively, * can be used here)</pre>
          <p>This specificity precedence ordering makes it possible to allow access to a more specific path while denying access to a less specific path.</p>
          <div class="example">
            <a id="idp34070160"></a>
            <p class="title">
              <b>Example 6.12. File Rule - Path Precedence</b>
            </p>
            <div class="example-contents">
              <p>The above precedence ordering allows one to deny read access to the root '/' directory and all its sub-directories, but allow read access to <span class="emphasis"><em>/tmp</em></span> and vice-versa.</p>
              <pre class="screen"># deny everything except '/tmp'
file:read:/:deny:info
file:read:/tmp:allow:info</pre>
              <p>OR</p>
              <pre class="screen"># allow everything except '/tmp'
file:read:/:allow:info
file:read:/tmp:deny:info</pre>
              <p>If two rules specify the same path as parameter, the rule with the most conservative action will be selected.</p>
            </div>
          </div>
          <br class="example-break" />
          <div class="example">
            <a id="idp34074256"></a>
            <p class="title">
              <b>Example 6.13. File Rule - Action Precedence</b>
            </p>
            <div class="example-contents">
              <p>In the following case, the rule with the destroy action is more conservative, and will thus be selected if the intercepted file is in <span class="emphasis"><em>/tmp</em></span> or in a directory below <span class="emphasis"><em>/tmp</em></span>.</p>
              <pre class="screen">file:read:/tmp:deny:info
file:read:/tmp:destroy:info</pre>
            </div>
          </div>
          <br class="example-break" />
          <p><span class="strong"><strong>Interceptable Operations</strong></span>
Attempts to read or write attributes associated with files can be intercepted. Specifically, it is possible to intercept:</p>
          <pre class="screen">java.io.File</pre>
          <p>Files can also be intercepted when an attempt is made to open them for reading and/or writing. More specifically, attempts to open files associated with the the following classes, and their sub-classes, can be intercepted:</p>
          <pre class="screen">java.io.RandomAccessFile
java.io.InputStream
java.io.OutputStream
java.util.zip.ZipFile</pre>
          <p><span class="strong"><strong>Caveats</strong></span>
<span class="strong"><strong>File Opened Before Rule Has Been Updated</strong></span>
If a file has been successfully opened prior to the application of a new rule to restrict it has been applied (through the live update mechanism), then unless the file is closed by the app and an attempt is made to reopen it, all reads/writes to that file will succeed. It is important to reiterate that interception can only be successful when an attempt is made to open the file.</p>
          <p><span class="strong"><strong>JNI Libraries</strong></span>
If JNI libraries are permitted, with no greylist or whitelist restrictions, then guarding at a file level will not prevent JNI libraries in corresponding guarded locations from being loaded.
However, if a JNI greylist and/or whitelist is provided, these will act as the file restrictions for JNI, and will override corresponding prohibited and allowed paths specified through file rules. Please refer to Native Rules section for more details on JNI loading, whitelist, and greylist.</p>
        </div>
        <div class="section" title="Network I/O - Keyword: network">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="network_i_o_keyword_network"></a>Network I/O - Keyword: network</h4>
              </div>
            </div>
          </div>
          <p>Fine-grained control is supported for all network actions a JVC may perform or attempt to perform. One example is to prevent a ServerSocket binding to a port which needs to be free for another purpose. Another example configuration could be to log warnings when a ServerSocket connection is received from an IP address that is considered suspicious. Some high-level examples of rules are:</p>
          <div class="itemizedlist">
            <ul class="itemizedlist">
              <li class="listitem">
Only accept socket connections from a defined set of remote hosts
</li>
              <li class="listitem">
Only allow outbound connections to a defined set of remote hosts
</li>
              <li class="listitem">
Restrict JVC to specific inbound/outbound ports
</li>
            </ul>
          </div>
          <p>The following example shows how a rule might be represented in a rules file.</p>
          <div class="example">
            <a id="idp34089712"></a>
            <p class="title">
              <b>Example 6.14. Network Bind Rule</b>
            </p>
            <div class="example-contents">
              <p>To restrict JVC’s ability to bind a socket to local port number 8080</p>
              <pre class="screen">network:bind::8080:suspend:debug</pre>
              <p>If the JVC attempts to bind to this port, the JVC’s execution will be suspended, and a message will be logged at the <span class="emphasis"><em>debug</em></span> <span class="emphasis"><em>&lt;loglevel&gt;</em></span> indicating that the attempt was made and that the JVC has been suspended.</p>
            </div>
          </div>
          <br class="example-break" />
          <div class="example">
            <a id="idp34093296"></a>
            <p class="title">
              <b>Example 6.15. Network Connect Rule</b>
            </p>
            <div class="example-contents">
              <p>Forbid connections only if they try to connect to the given hostname/IP <span class="strong"><strong>AND</strong></span> they connect over port 8080. Note the string “www.something.com:8080” given as a parameter.</p>
              <pre class="screen">network:connect:www.something.com:8080:suspend:debug</pre>
            </div>
          </div>
          <br class="example-break" />
          <p><span class="strong"><strong>&lt;subcategory&gt;</strong></span>
The types of access that can be intercepted are outlined in the following table.</p>
          <div class="table">
            <a id="idp34097104"></a>
            <p class="title">
              <b>Table 6.7. Network Sub-Category</b>
            </p>
            <div class="table-contents">
              <table summary="Network Sub-Category" border="1">
                <colgroup>
                  <col />
                  <col />
                </colgroup>
                <thead>
                  <tr>
                    <th align="left" valign="top">Rule Keyword</th>
                    <th align="left" valign="top">Description</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td align="left" valign="top">
                      <p>bind</p>
                    </td>
                    <td align="left" valign="top">
                      <p>Intercept attempts to bind a socket to an local IP/hostname and/or port.</p>
                    </td>
                  </tr>
                  <tr>
                    <td align="left" valign="top">
                      <p>connect</p>
                    </td>
                    <td align="left" valign="top">
                      <p>Intercept attempts to connect to a remote IP/hostname and/or port.</p>
                    </td>
                  </tr>
                  <tr>
                    <td align="left" valign="top">
                      <p>serverbind</p>
                    </td>
                    <td align="left" valign="top">
                      <p>Intercept attempts to bind a server to a local IP address and/or port, i.e. to listen.</p>
                    </td>
                  </tr>
                  <tr>
                    <td align="left" valign="top">
                      <p>accept</p>
                    </td>
                    <td align="left" valign="top">
                      <p>Intercept attempts to accept connections from a remote IP/hostname optionally on a specified local port.</p>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <br class="table-break" />
          <p><span class="strong"><strong>&lt;parameter&gt;</strong></span>
The expected parameter syntax is the same across network subcategories.</p>
          <div class="table">
            <a id="idp34114544"></a>
            <p class="title">
              <b>Table 6.8. Network Rule Parameter</b>
            </p>
            <div class="table-contents">
              <table summary="Network Rule Parameter" border="1">
                <colgroup>
                  <col />
                  <col />
                </colgroup>
                <thead>
                  <tr>
                    <th align="left" valign="top">&lt;subcategory&gt;</th>
                    <th align="left" valign="top">&lt;parameter&gt;</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td align="left" valign="top">
                      <p>bind</p>
                    </td>
                    <td align="left" valign="top">
                      <p>&lt;ip OR hostname&gt;:&lt;port&gt; (One or both elements must be specified.)</p>
                    </td>
                  </tr>
                  <tr>
                    <td align="left" valign="top">
                      <p>connect</p>
                    </td>
                    <td align="left" valign="top">
                      <p>&lt;ip OR hostname&gt;:&lt;port&gt; (One or both elements must be specified.)</p>
                    </td>
                  </tr>
                  <tr>
                    <td align="left" valign="top">
                      <p>serverbind</p>
                    </td>
                    <td align="left" valign="top">
                      <p>&lt;ip OR hostname&gt;:&lt;port&gt; (One or both elements must be specified.)</p>
                    </td>
                  </tr>
                  <tr>
                    <td align="left" valign="top">
                      <p>accept</p>
                    </td>
                    <td align="left" valign="top">
                      <p>&lt;ip OR hostname&gt;:&lt;port&gt; (One or both elements must be specified.)</p>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <br class="table-break" />
          <p><span class="strong"><strong>Wildcard Support</strong></span>
The syntax here allows wildcards, by leaving either IP/hostname or port blank. For example we can use any of the following two rules:</p>
          <pre class="screen">network:connect::8080:suspend:debug
network:connect:www.something.com::suspend:debug</pre>
          <p>In the first case, as we give a port only, we say that we forbid connections that try to connect through port 8080, regardless of the destination hostname/IP. Note the string ":8080" given as a parameter.</p>
          <p>In the second case, as we have only an address, we say that we forbid all connections to this hostname, regardless what port they try to use. Note the string "www.something.com:" given as a parameter.</p>
          <p>In addition, the following wildcard patterns can be used as parameter:</p>
          <div class="example">
            <a id="idp34134768"></a>
            <p class="title">
              <b>Example 6.16. Network Rule - Wildcard ip/host and port</b>
            </p>
            <div class="example-contents">
              <p>The following rules are all equivalent and effectively wildcard both ip/host and port.</p>
              <pre class="screen">network:connect:*::suspend:debug
network:connect::*:suspend:debug
network:connect:*:*:suspend:debug
network:connect:::suspend:debug</pre>
            </div>
          </div>
          <br class="example-break" />
          <div class="example">
            <a id="idp34136784"></a>
            <p class="title">
              <b>Example 6.17. Network Rule - Wildcard ip/host only</b>
            </p>
            <div class="example-contents">
              <pre class="screen">network:connect:*:8080:suspend:debug</pre>
            </div>
          </div>
          <br class="example-break" />
          <div class="example">
            <a id="idp34138176"></a>
            <p class="title">
              <b>Example 6.18. Network Rule - Wildcard port only</b>
            </p>
            <div class="example-contents">
              <pre class="screen">network:connect:www.something.com:*:suspend:debug</pre>
            </div>
          </div>
          <br class="example-break" />
        </div>
        <div class="section" title="Static Linking - Keyword: classlink">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="static_linking_keyword_classlink"></a>Static Linking - Keyword: classlink</h4>
              </div>
            </div>
          </div>
          <p>A JVC application can be given restricted access to entities such as packages, classes, methods, constructors and fields using a rule of this category. If a class of the JVC application attempts to access an entity that a rule dictates should be intercepted, the associated action will taken and the event will be logged.</p>
          <p><span class="strong"><strong>Descriptor Notation</strong></span>
A descriptor is simply a string that represents each entity in the notation as laid out by the Java Virtual Machine Specification - we follow this naming convention with the following important exception: all packages, classes and method names are all '.' separated as opposed to a '/' separated.</p>
          <p>4.2 The Internal Form of Fully Qualified Class and Interface Names</p>
          <p>
            <a class="ulink" href="http://docs.oracle.com/javase/specs/jvms/se5.0/html/ClassFile.doc.html#14757" target="_top">http://docs.oracle.com/javase/specs/jvms/se5.0/html/ClassFile.doc.html#14757</a>
          </p>
          <p>The appropriate descriptor notation for methods and fields are in the following subsections of the Java Virtual Machine Specification,</p>
          <p>4.3.3 Method Descriptors</p>
          <p>
            <a class="ulink" href="http://docs.oracle.com/javase/specs/jvms/se5.0/html/ClassFile.doc.html#7035" target="_top">http://docs.oracle.com/javase/specs/jvms/se5.0/html/ClassFile.doc.html#7035</a>
          </p>
          <p>4.3.2 Field Descriptors</p>
          <p>
            <a class="ulink" href="http://docs.oracle.com/javase/specs/jvms/se5.0/html/ClassFile.doc.html#14152" target="_top">http://docs.oracle.com/javase/specs/jvms/se5.0/html/ClassFile.doc.html#14152</a>
          </p>
          <p>Descriptors can provide fine-grained control over which specific entities are disallowed or a more general descriptor can be provided that covers broader cases. For example, given the following class,</p>
          <div class="example">
            <a id="idp34147824"></a>
            <p class="title">
              <b>Example 6.19. Simple Example</b>
            </p>
            <div class="example-contents">
              <pre class="prettyprint">public class C {
    // Descriptor for this method,
    // C.m1(I)V
    private void m1(int p) { }

    // Descriptor for this method,
    // C.m1(J)V
    private void m1(long p) { }
}</pre>
              <p>The following specific rule disallows classes from accessing C.m1(int p)</p>
              <p>
                <span class="emphasis">
                  <em>classlink:class:C.m1(I)V:shutdown:info</em>
                </span>
              </p>
              <p>And the following general rule disallows classes from accessing all methods named m1 in class C</p>
              <p>
                <span class="emphasis">
                  <em>classlink:class:C.m1:shutdown:info</em>
                </span>
              </p>
            </div>
          </div>
          <br class="example-break" />
          <div class="example">
            <a id="idp34152096"></a>
            <p class="title">
              <b>Example 6.20. Detailed Example</b>
            </p>
            <div class="example-contents">
              <pre class="prettyprint">package classlinktest;
// classlinktest.Test
public class Test {
    private String f;
    public Test() { }
    public Test(String p) { }
    public static void main(String[] args) {
        // classlinktest.Test.&lt;init&gt;()V
        Test t = new Test();
        // classlinktest.Test.&lt;init&gt;(Ljava.lang.String;)V
        t = new Test("");
        // classlinktest.Test.method(Ljava.lang.String;)Ljava.lang.String;
        t.method("");
        // classlinktest.Test.method(I)V
        t.method(0);
        // classlinktest.Test.fLjava.lang.String;
        t.f = "";
    }
    private String method(String p) { return ""; }
    private void method(int p) { }
}</pre>
              <p>and the following rules we explain what entities are disallowed.</p>
              <p>Disallow classes accessing the class classlinktest.Test</p>
              <pre class="screen">classlink:class:classlinktest.Test:shutdown:info</pre>
              <p>Disallow classes accessing all classes in the package classlinktest</p>
              <pre class="screen">classlink:class:classlinktest:shutdown:info</pre>
              <p>Disallow classes accessing the named constructor</p>
              <pre class="screen">classlink:class:classlinktest.Test.&lt;init&gt;(Ljava.lang.String;)V:shutdown:info</pre>
              <p>Disallow classes accessing all constructors in classlinktest.Test</p>
              <pre class="screen">classlink:class:classlinktest.Test.&lt;init&gt;:shutdown:info</pre>
              <p>Disallow classes accessing the named method</p>
              <pre class="screen">classlink:class:classlinktest.Test.method(Ljava.lang.String;)Ljava.lang.String;:shutdown:info</pre>
              <p>Disallow classes accessing all methods in classlinktest.Test that start with "method"</p>
              <pre class="screen">classlink:class:classlinktest.Test.method:shutdown:info</pre>
              <p>Disallow classes accessing the field - note the class and field are not '.' separated</p>
              <pre class="screen">classlink:class:classlinktest.Test.fLjava.lang.String;:shutdown:info</pre>
            </div>
          </div>
          <br class="example-break" />
          <p>In the following example</p>
          <div class="example">
            <a id="idp34163872"></a>
            <p class="title">
              <b>Example 6.21. Method Present, Not Invoked</b>
            </p>
            <div class="example-contents">
              <pre class="prettyprint">package classlinktest;
public class Test {
    public static void main(String[] args) { }
    private void method(int p) { }
}</pre>
              <p>the following class link rule would not prevent the class Test from loading</p>
              <pre class="screen">classlink:class:classlinktest.Test.method(I)V:shutdown:info</pre>
              <p>since Test does not invoke the method given in the rule it only defines the method - this is an important distinction.</p>
            </div>
          </div>
          <br class="example-break" />
          <p><span class="strong"><strong>Wildcard Support</strong></span>
The wildcard character, asterisk '*', when used as a single parameter, represent all packages, classes, methods fields and constructors.</p>
          <div class="example">
            <a id="idp34168896"></a>
            <p class="title">
              <b>Example 6.22. ClassLink Rule - All Packages</b>
            </p>
            <div class="example-contents">
              <p>Deny all packages by way of shutting down the JVC:</p>
              <pre class="screen">classlink:class:*:shutdown:debug</pre>
              <p>This rule alone will most likely prohibit the application from executing in the first place.
However, wildcard deny actions (deny, shutdown, destroy, suspend) can be useful in combination with
allow actions for more specific classes and packages:</p>
              <pre class="screen">classlink:class:*:shutdown:debug
classlink:class:java.lang.*:allow:debug
classlink:class:my.package.MainClass:allow:debug</pre>
            </div>
          </div>
          <br class="example-break" />
          <div class="example">
            <a id="idp34172240"></a>
            <p class="title">
              <b>Example 6.23. ClassLink Rule - Specific Packages</b>
            </p>
            <div class="example-contents">
              <p>Deny classes in a specific package by way of shutting down the JVC, three forms:</p>
              <pre class="screen">classlink:class:the.package.name.*:shutdown:debug
classlink:class:the.package.name.:shutdown:debug
classlink:class:the.package.name:shutdown:debug</pre>
            </div>
          </div>
          <br class="example-break" />
          <div class="example">
            <a id="idp34174320"></a>
            <p class="title">
              <b>Example 6.24. ClassLink Rule - All Class Members</b>
            </p>
            <div class="example-contents">
              <p>Deny all members of a specific class by way of shutting down the JVC, two forms:</p>
              <pre class="screen">classlink:class:the.package.name.classname.*:shutdown:debug
classlink:class:the.package.name.classname.:shutdown:debug</pre>
            </div>
          </div>
          <br class="example-break" />
          <div class="example">
            <a id="idp34176448"></a>
            <p class="title">
              <b>Example 6.25. ClassLink Rule - All Inner-Classes</b>
            </p>
            <div class="example-contents">
              <p>Deny all inner classes of a specific class by way of shutting down the JVC, two forms:</p>
              <pre class="screen">classlink:class:the.package.name.classname$*:shutdown:debug
classlink:class:the.package.name.classname$:shutdown:debug</pre>
            </div>
          </div>
          <br class="example-break" />
          <div class="example">
            <a id="idp34178576"></a>
            <p class="title">
              <b>Example 6.26. ClassLink Rule - All Inner-Class Members</b>
            </p>
            <div class="example-contents">
              <p>Deny all members of a specific inner class by way of shutting down the JVC, two forms:</p>
              <pre class="screen">classlink:class:the.package.name.classname$innerclassname.*:shutdown:debug
classlink:class:the.package.name.classname$innerclassname.:shutdown:debug</pre>
            </div>
          </div>
          <br class="example-break" />
          <div class="example">
            <a id="idp34180768"></a>
            <p class="title">
              <b>Example 6.27. ClassLink Rule - Wildcard Partial Names</b>
            </p>
            <div class="example-contents">
              <p>The asterisk wildcard can be used to specify the prefix of a package, class, member, inner class, and inner class member:</p>
              <pre class="screen">classlink:class:java.la*:shutdown:debug
classlink:class:java.lang.Str*:shutdown:debug
classlink:class:java.lang.String.hash*:shutdown:debug
classlink:class:the.package.name.classname$innercl*:shutdown:debug
classlink:class:the.package.name.classname$innerclassname.variab*:shutdown:debug</pre>
            </div>
          </div>
          <br class="example-break" />
        </div>
        <div class="section" title="Reflection (Dynamic Linking) - Keyword: reflect">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="reflection_dynamic_linking_keyword_reflect"></a>Reflection (Dynamic Linking) - Keyword: reflect</h4>
              </div>
            </div>
          </div>
          <p>Reflection access packages, classes and members using this rule category. For example, using rules that disallow reflection of all package-private and private fields and methods of all classes loaded from rt.jar can be defined. Combined with static linking rules, many of the most serious Java security vulnerabilities can be hardened, and attempts at exploiting them can be logged and disallowed.
The following example shows how a rule might be represented in a rules file.</p>
          <div class="example">
            <a id="idp34185536"></a>
            <p class="title">
              <b>Example 6.28. Reflection Rule - Class</b>
            </p>
            <div class="example-contents">
              <p>To prevent a JVC from accessing, through reflection, all constructors, methods and fields of the class, com.blah.MyClass, the following rule may be used:</p>
              <pre class="screen">reflect:class:com.blah.MyClass:shutdown:debug</pre>
              <p>If the JVC attempts to reflect methods, constructors or fields of the specified class, the JVC will be shutdown, and a message will be logged at the <span class="emphasis"><em>debug</em></span> level indicating that the attempt was made and that the JVC was shutdown.</p>
            </div>
          </div>
          <br class="example-break" />
          <div class="example">
            <a id="idp34188512"></a>
            <p class="title">
              <b>Example 6.29. Reflection Rule - Field</b>
            </p>
            <div class="example-contents">
              <p>To prevent a JVC from accessing, through reflection, the <span class="emphasis"><em>theUnsafe</em></span> field of the class, sun.misc.Unsafe, the following rule may be used:</p>
              <pre class="screen">reflect:class:sun.misc.Unsafe:field:theUnsafe:deny:error</pre>
              <p>If the JVC attempts to reflect the specified field of the class, the attempt will be denied, and a message will be logged at the <span class="emphasis"><em>error</em></span> level indicating that the attempt was made and that it was denied.</p>
            </div>
          </div>
          <br class="example-break" />
          <div class="example">
            <a id="idp34191904"></a>
            <p class="title">
              <b>Example 6.30. Reflection Rule - Warn</b>
            </p>
            <div class="example-contents">
              <p>To allow, but warn that a JVC is accessing, through reflection, either constructors, methods or fields of the class, sun.misc.Unsafe, the following rule may be used:</p>
              <pre class="screen">reflect:class:sun.misc.Unsafe:allow:warn</pre>
              <p>If the JVC reflects methods, constructors or fields of the specified class, it will be allowed to proceed, but a message will be logged at the <span class="emphasis"><em>warn</em></span> level indicating that the reflected access took place.</p>
            </div>
          </div>
          <br class="example-break" />
          <div class="example">
            <a id="idp34194784"></a>
            <p class="title">
              <b>Example 6.31. Reflection Rule - Method</b>
            </p>
            <div class="example-contents">
              <p>To prevent a JVC from accessing, through reflection, the <span class="emphasis"><em>getUnsafe()Lsun/misc/Unsafe;</em></span> method of the class, sun.misc.Unsafe, the following rule may be used:</p>
              <pre class="screen">reflect:class:sun.misc.Unsafe:method:getUnsafe()Lsun/misc/Unsafe;:destroy:error</pre>
              <p>If the JVC attempts to reflect the specified field of the class, the JVC will be destroyed, and a message will be logged at the <span class="emphasis"><em>error</em></span> level indicating that the attempt was made and that the JVC was destroyed.</p>
            </div>
          </div>
          <br class="example-break" />
          <div class="example">
            <a id="idp34198208"></a>
            <p class="title">
              <b>Example 6.32. Reflection Rule - Package</b>
            </p>
            <div class="example-contents">
              <p>To prevent a JVC from accessing, through reflection, any class in the sun.misc package, the following rule may be used:</p>
              <pre class="screen">reflect:class:sun.misc.*:deny:error</pre>
              <p>Note the use of the wildcard. If the JVC attempts to reflect any classes in the specified package, the attempt will be denied, and a message will be logged at the <span class="emphasis"><em>error</em></span> level indicating that the attempt took place, and was denied.</p>
            </div>
          </div>
          <br class="example-break" />
          <p><span class="strong"><strong>&lt;subcategory&gt;</strong></span>
The types of access that can be intercepted are outlined in the following table. Note that the <span class="emphasis"><em>class</em></span> subcategory here is quite generic and allows reflection operations to be intercepted at either a package level, class level or class-member level.</p>
          <div class="table">
            <a id="idp34202800"></a>
            <p class="title">
              <b>Table 6.9. Reflect Sub-category</b>
            </p>
            <div class="table-contents">
              <table summary="Reflect Sub-category" border="1">
                <colgroup>
                  <col />
                  <col />
                </colgroup>
                <thead>
                  <tr>
                    <th align="left" valign="top">Rule Keyword</th>
                    <th align="left" valign="top">Description</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td align="left" valign="top">
                      <p>class</p>
                    </td>
                    <td align="left" valign="top">
                      <p>Intercept attempts to reflect classes of a package or members of a class.</p>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <br class="table-break" />
          <p><span class="strong"><strong>&lt;parameter&gt;</strong></span>
Expected <span class="emphasis"><em>&lt;parameter&gt;</em></span> for each reflect sub-category is outlined in the following table. Note that in the case of constructor, method and field interception, corresponding keywords are used within the parameter itself. Note that one and only one entity can be specified within the <span class="emphasis"><em>&lt;parameter&gt;</em></span> component.</p>
          <div class="table">
            <a id="idp34213776"></a>
            <p class="title">
              <b>Table 6.10. Reflect Rule Parameter</b>
            </p>
            <div class="table-contents">
              <table summary="Reflect Rule Parameter" border="1">
                <colgroup>
                  <col />
                  <col />
                  <col />
                </colgroup>
                <thead>
                  <tr>
                    <th align="left" valign="top">Entity</th>
                    <th align="left" valign="top">&lt;parameter&gt;</th>
                    <th align="left" valign="top">Example</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td align="left" valign="top">
                      <p>Package</p>
                    </td>
                    <td align="left" valign="top">
                      <p>&lt;package-name&gt;.*</p>
                    </td>
                    <td align="left" valign="top">
                      <p>sun.misc.*</p>
                    </td>
                  </tr>
                  <tr>
                    <td align="left" valign="top">
                      <p>Class</p>
                    </td>
                    <td align="left" valign="top">
                      <p>&lt;package-name&gt;.&lt;class-name&gt;</p>
                    </td>
                    <td align="left" valign="top">
                      <p>sun.misc.Unsafe</p>
                    </td>
                  </tr>
                  <tr>
                    <td align="left" valign="top">
                      <p>Constructor</p>
                    </td>
                    <td align="left" valign="top">
                      <p>&lt;package-name&gt;.&lt;class-name&gt;:constructor:&lt;constructor-signature&gt;</p>
                    </td>
                    <td align="left" valign="top">
                      <p>sun.misc.Unsafe:constructor:
&lt;init&gt;()V</p>
                    </td>
                  </tr>
                  <tr>
                    <td align="left" valign="top">
                      <p>Method</p>
                    </td>
                    <td align="left" valign="top">
                      <p>&lt;package-name&gt;.&lt;class-name&gt;:method:&lt;method-signature&gt;</p>
                    </td>
                    <td align="left" valign="top">
                      <p>sun.misc.Unsafe:method:
getUnsafe()Lsun/misc/Unsafe;</p>
                    </td>
                  </tr>
                  <tr>
                    <td align="left" valign="top">
                      <p>Field</p>
                    </td>
                    <td align="left" valign="top">
                      <p>&lt;package-name&gt;.&lt;class-name&gt;:field:&lt;field-name&gt;</p>
                    </td>
                    <td align="left" valign="top">
                      <p>sun.misc.Unsafe:field:theUnsafe</p>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <br class="table-break" />
          <p><span class="strong"><strong>Wildcard Support</strong></span>
The wildcard character, asterisk '*', when used as a single parameter, represent all packages, classes, methods, fields and constructors.</p>
          <div class="example">
            <a id="idp34240576"></a>
            <p class="title">
              <b>Example 6.33. Reflection Rule - All Packages</b>
            </p>
            <div class="example-contents">
              <p>Deny all packages by way of shutting down the JVC:</p>
              <pre class="screen">reflect:class:*:shutdown:debug</pre>
            </div>
          </div>
          <br class="example-break" />
          <div class="example">
            <a id="idp34242352"></a>
            <p class="title">
              <b>Example 6.34. Reflection Rule - All Classes in a Package</b>
            </p>
            <div class="example-contents">
              <p>Deny classes in a specific package by way of shutting down the JVC, three forms:</p>
              <pre class="screen">reflect:class:the.package.name.*:shutdown:debug
reflect:class:the.package.name.:shutdown:debug
reflect:class:the.package.name:shutdown:debug</pre>
            </div>
          </div>
          <br class="example-break" />
          <div class="example">
            <a id="idp34244432"></a>
            <p class="title">
              <b>Example 6.35. Reflection Rule - All Methods</b>
            </p>
            <div class="example-contents">
              <p>Deny all methods of a specific class by way of shutting down the JVC:</p>
              <pre class="screen">reflect:class:the.package.name.classname:method:*:shutdown:debug</pre>
            </div>
          </div>
          <br class="example-break" />
          <div class="example">
            <a id="idp34246368"></a>
            <p class="title">
              <b>Example 6.36. Reflection Rule - All Fields</b>
            </p>
            <div class="example-contents">
              <p>Deny all fields of a specific class by way of shutting down the JVC:</p>
              <pre class="screen">reflect:class:the.package.name.classname:field:*:shutdown:debug</pre>
            </div>
          </div>
          <br class="example-break" />
          <div class="example">
            <a id="idp34248304"></a>
            <p class="title">
              <b>Example 6.37. Reflection Rule - All Constructors</b>
            </p>
            <div class="example-contents">
              <p>Deny all constructors of a specific class by way of shutting down the JVC:</p>
              <pre class="screen">reflect:class:the.package.name.classname:constructor:*:shutdown:debug</pre>
            </div>
          </div>
          <br class="example-break" />
          <div class="example">
            <a id="idp34250256"></a>
            <p class="title">
              <b>Example 6.38. Reflection Rule - All Inner-Classes of a Class</b>
            </p>
            <div class="example-contents">
              <p>Deny all inner classes of a specific class by way of shutting down the JVC, three forms:</p>
              <pre class="screen">reflect:class:the.package.name.classname$*:shutdown:debug
reflect:class:the.package.name.classname$:shutdown:debug
reflect:class:the.package.name.classname*:shutdown:debug</pre>
            </div>
          </div>
          <br class="example-break" />
          <div class="example">
            <a id="idp34252384"></a>
            <p class="title">
              <b>Example 6.39. Reflection Rule - All Methods of Inner-Class</b>
            </p>
            <div class="example-contents">
              <p>Deny all methods of a specific inner class by way of shutting down the JVC:</p>
              <pre class="screen">reflect:class:the.package.name.classname$innerclassname:method:*:shutdown:debug</pre>
            </div>
          </div>
          <br class="example-break" />
          <div class="example">
            <a id="idp34254352"></a>
            <p class="title">
              <b>Example 6.40. Reflection Rule - All Fields of Inner-Class</b>
            </p>
            <div class="example-contents">
              <p>Deny all fields of a specific inner class by way of shutting down the JVC:</p>
              <pre class="screen">reflect:class:the.package.name.classname$innerclassname:field:*:shutdown:debug</pre>
            </div>
          </div>
          <br class="example-break" />
          <div class="example">
            <a id="idp34256320"></a>
            <p class="title">
              <b>Example 6.41. Reflection Rule - All Constructorss of Inner-Class</b>
            </p>
            <div class="example-contents">
              <p>Deny all constructors of a specific inner class by way of shutting down the JVC.</p>
              <pre class="screen">reflect:class:the.package.name.classname$innerclassname:constructor:*:shutdown:debug</pre>
            </div>
          </div>
          <br class="example-break" />
          <div class="example">
            <a id="idp34258288"></a>
            <p class="title">
              <b>Example 6.42. Reflection Rule - Wildcard Partial Names</b>
            </p>
            <div class="example-contents">
              <p>The asterisk wildcard can be used to specify the prefix of a class member, or inner class member:</p>
              <pre class="screen">reflect:class:java.lang.String.hash*:shutdown:debug
reflect:class:the.package.name.classname$innerclassname.variab*:shutdown:debug</pre>
            </div>
          </div>
          <br class="example-break" />
          <p>
            <span class="strong">
              <strong>Rule Precedence</strong>
            </span>
          </p>
          <div class="itemizedlist">
            <ul class="itemizedlist">
              <li class="listitem">
If a package rule exists that corresponds to that represented in a member rule, then the rule will be triggered at the package level.
</li>
              <li class="listitem">
If a class rule exists that corresponds to that represented in a member rule, then the rule will be triggered at the class level.
</li>
              <li class="listitem">
Member rules are equal in precedence terms.
</li>
            </ul>
          </div>
          <p>
            <span class="strong">
              <strong>Caveats</strong>
            </span>
          </p>
          <div class="itemizedlist">
            <ul class="itemizedlist">
              <li class="listitem">
Member rules apply only to the member specified, and are not polymorphically applied to descendants that may override corresponding the corresponding member.
</li>
              <li class="listitem">
Static linking rules and Reflection rules are currently not interrelated and one cannot override the other at the moment.
</li>
              <li class="listitem">
Avoid using multiple reflection rules with the same parameter, but different actions, as action precedence is currently not supported for reflection. The same applies for the case where the rule is only different in terms of log level.
</li>
            </ul>
          </div>
        </div>
        <div class="section" title="Errors and Exceptions - Keyword: throwable">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="errors_and_exceptions_keyword_throwable"></a>Errors and Exceptions - Keyword: throwable</h4>
              </div>
            </div>
          </div>
          <p>Often exceptions or errors can be raised within a JVM by an application attempting to perform malicious actions, but this information is invisible to systems administrators and programmers. Fine-grained rules are supported to log and to act on the creation of specific throwable objects, which can provide early-warning of erroneous or potentially malicious behaviour by an application program. Some high-level rule examples are:</p>
          <div class="itemizedlist">
            <ul class="itemizedlist">
              <li class="listitem">
Terminate or suspend a JVC in the event of specific exceptions, such as java.sql.SQLIntegrityConstraintViolationException
</li>
              <li class="listitem">
Log warnings when specific exceptions occur in a JVC, such as java.lang.instrument.IllegalClassFormatException
</li>
              <li class="listitem">
The following example shows how a rule might be represented in a rules file.
</li>
            </ul>
          </div>
          <div class="example">
            <a id="idp34274288"></a>
            <p class="title">
              <b>Example 6.43. Throwable Rule - Shutdown If Specific Exception Created</b>
            </p>
            <div class="example-contents">
              <p>To suspend a JVC in the event of a specific exception being created</p>
              <pre class="screen">throwable:throw:java.sql.SQLIntegrityConstraintViolationException:suspend:error</pre>
              <p>If the JVC creates the specified exception, the JVC’s execution will be suspended, and a message will be logged at the error '&lt;loglevel&gt; indicating that the exception was thrown and the JVC was suspended.</p>
            </div>
          </div>
          <br class="example-break" />
          <p><span class="strong"><strong>&lt;subcategory&gt;</strong></span>
The error sub-categories are outlined in the following table.</p>
          <div class="table">
            <a id="idp34278096"></a>
            <p class="title">
              <b>Table 6.11. Throwable Sub-category</b>
            </p>
            <div class="table-contents">
              <table summary="Throwable Sub-category" border="1">
                <colgroup>
                  <col />
                  <col />
                </colgroup>
                <thead>
                  <tr>
                    <th align="left" valign="top">Rule Keyword</th>
                    <th align="left" valign="top">Description</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td align="left" valign="top">
                      <p>throw</p>
                    </td>
                    <td align="left" valign="top">
                      <p>Intercept the point where the throwable object  is created</p>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <br class="table-break" />
          <p><span class="strong"><strong>&lt;parameter&gt;</strong></span>
Expected <span class="emphasis"><em>&lt;parameter&gt;</em></span> for each of the error subcategories can be found in the following table.</p>
          <div class="table">
            <a id="idp34288496"></a>
            <p class="title">
              <b>Table 6.12. Throwable Rule Parameter</b>
            </p>
            <div class="table-contents">
              <table summary="Throwable Rule Parameter" border="1">
                <colgroup>
                  <col />
                  <col />
                </colgroup>
                <thead>
                  <tr>
                    <th align="left" valign="top">&lt;subcategory&gt;</th>
                    <th align="left" valign="top">&lt;parameter&gt;</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td align="left" valign="top">
                      <p>throw</p>
                    </td>
                    <td align="left" valign="top">
                      <p>&lt;throwable-class-name&gt;</p>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <br class="table-break" />
          <p><span class="strong"><strong>Wildcard Support</strong></span>
The wildcard character, asterisk '*', when used as a single parameter, represent all throwable classes, with some exceptional cases, see note following this section.</p>
          <div class="example">
            <a id="idp34298512"></a>
            <p class="title">
              <b>Example 6.44. Throwable Rule - All Throwable Classes</b>
            </p>
            <div class="example-contents">
              <p>Deny all throwable classes by way of shutting down the JVC:</p>
              <pre class="screen">throwable:throw:*:shutdown:debug</pre>
            </div>
          </div>
          <br class="example-break" />
          <div class="example">
            <a id="idp34300368"></a>
            <p class="title">
              <b>Example 6.45. Throwable Rule - Throwable Classes in a Specific Package</b>
            </p>
            <div class="example-contents">
              <p>Deny all throwable classes in a specific package by way of shutting down the JVC, two forms:</p>
              <pre class="screen">throwable:throw:the.package.name.*:shutdown:debug
throwable:throw:the.package.name.:shutdown:debug</pre>
            </div>
          </div>
          <br class="example-break" />
          <div class="example">
            <a id="idp34302544"></a>
            <p class="title">
              <b>Example 6.46. Throwable Rule - Wildcard Partial Class Name</b>
            </p>
            <div class="example-contents">
              <div class="variablelist">
                <dl>
                  <dt>
                    <span class="term">
Deny all throwable classes matching a partial class name
</span>
                  </dt>
                  <dd></dd>
                </dl>
              </div>
              <pre class="screen">throwable:throw:the.package.name.classna*:shutdown:debug</pre>
            </div>
          </div>
          <br class="example-break" />
          <div class="note" title="NOTE">
            <table border="0" summary="Note: NOTE">
              <tr>
                <td rowspan="2" align="center" valign="top" width="25">
                  <img alt="[Note]" src="./images/icons//note.png" />
                </td>
                <th align="left">NOTE</th>
              </tr>
              <tr>
                <td align="left" valign="top">
                  <p>It is not possible to enforce restrictions on the following common throwable classes (and their subclasses):</p>
                  <div class="itemizedlist">
                    <ul class="itemizedlist">
                      <li class="listitem">
ArithmeticException.class,
</li>
                      <li class="listitem">
ArrayIndexOutOfBoundsException.class,
</li>
                      <li class="listitem">
ArrayStoreException.class,
</li>
                      <li class="listitem">
ClassCastException.class,
</li>
                      <li class="listitem">
Error.class,
</li>
                      <li class="listitem">
ExceptionInInitializerError.class,
</li>
                      <li class="listitem">
IllegalMonitorStateException.class,
</li>
                      <li class="listitem">
ClassNotFoundException.class,
</li>
                      <li class="listitem">
NullPointerException.class.
</li>
                    </ul>
                  </div>
                  <p>So when using a wildcard to intercept all throwable constructions, the above classes will not be intercepted.</p>
                </td>
              </tr>
            </table>
          </div>
          <p><span class="strong"><strong>Caveats</strong></span>
The ‘deny’ action is not supported for throwable rules. Specifying ‘deny’ as the action in a throwable rule will result in a parsing error and the rules file will not be loaded.</p>
        </div>
        <div class="section" title="Native Library (JNI) - Keyword: native">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="native_library_jni_keyword_native"></a>Native Library (JNI) - Keyword: native</h4>
              </div>
            </div>
          </div>
          <p>Native library loading can be controlled through this rule category. JNI loading can be enabled/disabled through JNI library Whitelist, Blacklist and Greylist support.</p>
          <div class="itemizedlist">
            <ul class="itemizedlist">
              <li class="listitem">
Each native rule will accommodate, as parameter, one library file path, with an optional checksum to assist in the identification of a specific file if required. Wildcards are supported (this aspect is covered in a later section), and if the file part of a rule parameter is wildcarded, provision of a checksum will cause a parsing error.
</li>
              <li class="listitem">
Native actions: whitelist, greylist and blacklist, are only supported by native rules. Other actions: allow, deny, suspend, shutdown, and destroy are not supported by native rules.
</li>
              <li class="listitem">
Whitelist and Blacklist are mutually exclusive, and both cannot appear in the rules file. The parser checks this.
</li>
              <li class="listitem">
Greylist can be specified on its own or in addition to either a blacklist or a whitelist.
</li>
              <li class="listitem">
If no lists are present, then whitelist is assumed.
</li>
              <li class="listitem">
If greylist only is present and the library in question is not listed then the presence of either a blacklist or whitelist determines whether the library should be denied or not.
</li>
              <li class="listitem">
Rules are ordered according to specificity.
</li>
              <li class="listitem">
A rule parameter that includes a checksum will be considered more specific than a rule without one.
For rules with identical parameters, greylist will be selected over either whitelist or blacklist.
</li>
            </ul>
          </div>
          <p><span class="strong"><strong>List Types (Represented by Actions)</strong></span>
The function of the whitelist and blacklist is clear. The whitelist indicates libraries that are allowed, and the blacklist indicates those that are not allowed. However, a greylisted library is executed in a new external process called remote_native with an argument that is the full path to the library to be isolated. More details on JNI isolation of this nature can be found in the preceding section (JNI Isolation). List members are identified by the action associated with the rule. So, for Native Rules, there are three actions that can be applied, namely, whitelist, blacklist and greylist. There can be multiple rules, each with the same action, effectively representing a list of libraries associated with that action.</p>
          <p><span class="strong"><strong>Checksum</strong></span>
It is not mandatory to include the checksum for a native library in the list. If a checksum hash
value for a native library is included in parameter, and that value does not match a freshly generated
hash for the library, the JVM will throw an UnsatisfiedLinkError indicating MD5Sum mismatch and
the library will not load.</p>
          <p>The following examples show how a rule might be represented in rules file.</p>
          <div class="example">
            <a id="idp34331088"></a>
            <p class="title">
              <b>Example 6.47. Native Rule - Blacklist</b>
            </p>
            <div class="example-contents">
              <p>Deny all libraries:</p>
              <pre class="screen">    native:library:*:blacklist:info</pre>
            </div>
          </div>
          <br class="example-break" />
          <div class="example">
            <a id="idp34332864"></a>
            <p class="title">
              <b>Example 6.48. Native Rule - Whitelist</b>
            </p>
            <div class="example-contents">
              <p>Allow all libraries:</p>
              <pre class="screen">    native:library:*:whitelist:info</pre>
            </div>
          </div>
          <br class="example-break" />
          <div class="example">
            <a id="idp34334640"></a>
            <p class="title">
              <b>Example 6.49. Native Rule - Greylist with Blacklist</b>
            </p>
            <div class="example-contents">
              <p>Allow only remote execution of lib.so, deny all others:</p>
              <pre class="screen">    native:library:*:blacklist:info
    native:library:lib.so:greylist:info</pre>
            </div>
          </div>
          <br class="example-break" />
          <div class="example">
            <a id="idp34336576"></a>
            <p class="title">
              <b>Example 6.50. Native Rule - Greylist with Whitelist</b>
            </p>
            <div class="example-contents">
              <p>Allow only remote execution of lib.so, allow all others:</p>
              <pre class="screen">    native:library:*:whitelist:info
    native:library:lib.so:greylist:info</pre>
            </div>
          </div>
          <br class="example-break" />
          <div class="example">
            <a id="idp34338592"></a>
            <p class="title">
              <b>Example 6.51. Native Rule - Blacklist</b>
            </p>
            <div class="example-contents">
              <p>Deny lib1.so and lib2.so libraries only:</p>
              <pre class="screen">    native:library:lib1.so:blacklist:info
    native:library:lib2.so:blacklist:info</pre>
            </div>
          </div>
          <br class="example-break" />
          <div class="example">
            <a id="idp34340544"></a>
            <p class="title">
              <b>Example 6.52. Native Rule - Precedence</b>
            </p>
            <div class="example-contents">
              <p>Below, the greylist will be checked first. If the associated library path matches, then the checksum must match for the library to be greylisted. If the checksum doesn’t match, an UnsatisfiedLinkError will be thrown. In this example, all other libraries will be blacklisted.</p>
              <pre class="screen">    native:library:*:blacklist:info
    native:library:lib1.so;67834578367863453465675:greylist:info</pre>
              <p>Below, if lib.so is attempted to be loaded and it appears in both a blacklist and greylist,
then the greylist will take precedence, and the blacklist will not have an effect.</p>
              <pre class="screen">    native:library:lib1.so:blacklist:info
    native:library:lib1.so:greylist:info</pre>
            </div>
          </div>
          <br class="example-break" />
          <p><span class="strong"><strong>&lt;subcategory&gt;</strong></span>
In the case of the <span class="emphasis"><em>native</em></span> category, the &lt;subcategory&gt;, in conjunction with the &lt;parameter&gt;, is used to specify interception criteria.</p>
          <div class="table">
            <a id="idp34345968"></a>
            <p class="title">
              <b>Table 6.13. Native Sub-category</b>
            </p>
            <div class="table-contents">
              <table summary="Native Sub-category" border="1">
                <colgroup>
                  <col />
                  <col />
                </colgroup>
                <thead>
                  <tr>
                    <th align="left" valign="top">Rule Keyword</th>
                    <th align="left" valign="top">Description</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td align="left" valign="top">
                      <p>library</p>
                    </td>
                    <td align="left" valign="top">
                      <p>Intercept attempts to load a specified library.</p>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <br class="table-break" />
          <p><span class="strong"><strong>&lt;parameter&gt;</strong></span>
The parameter is a string representing a library file name or path. A checksum can optionally be included by using a semi-colon as separator, e.g.</p>
          <pre class="screen">    native:library:lib1.so;67834578367863453465675:blacklist:info</pre>
          <p>The filename part of the parameter conforms to the same criteria as that of the file rule (see file rule section).</p>
          <p><span class="strong"><strong>Wildcard Support</strong></span>
There are effectively 2 wildcard characters that, when used as a single parameter, represent all files on the file system, asterisk '*' and slash '/'.</p>
          <div class="example">
            <a id="idp34358352"></a>
            <p class="title">
              <b>Example 6.53. Native Rule - Wildcards</b>
            </p>
            <div class="example-contents">
              <p>To deny loading of all library files on filesystem, any one of the following rules can be specified:</p>
              <pre class="screen">native:library:*:blacklist:info
native:library:/:blacklist:info</pre>
            </div>
          </div>
          <br class="example-break" />
          <div class="note" title="Note">
            <table border="0" summary="Note">
              <tr>
                <td rowspan="2" align="center" valign="top" width="25">
                  <img alt="[Note]" src="./images/icons//note.png" />
                </td>
                <th align="left"></th>
              </tr>
              <tr>
                <td align="left" valign="top">
                  <p>Wildcards can only be applied to the filename part of the parameter, and not to the checksum (if included). Also, if a wildcarded filename is specified, then a checksum cannot be specified, and a parsing error will occur.</p>
                </td>
              </tr>
            </table>
          </div>
          <p><span class="strong"><strong>Precedence</strong></span>
Since blacklist and whitelist actions are mutually exclusive, it is possible to have, at most, greylist rules combined with either blacklist rules or whitelist rules. If greylist rules are provided, they will be checked first.</p>
          <p><span class="strong"><strong>Interceptable Operations</strong></span>
Attempts to load library files can be intercepted. Specifically, it is possible to intercept:</p>
          <pre class="screen">java.lang.Runtime.load( String filename )</pre>
        </div>
        <div class="section" title="SQL - Keyword: sql">
          <div class="titlepage">
            <div>
              <div>
                <h4 class="title"><a id="sql_keyword_sql"></a>SQL - Keyword: sql</h4>
              </div>
            </div>
          </div>
          <p>SQL injection attacks constitute one of the main forms of vulnerability in modern software systems. This rule category allows a user to specify that all incoming SQL parameters that have been received via a http request should be checked for suspicious patterns. When talking about a parameter we mean a user-supplied piece of data that will be placed into an SQL statement by the application. An example would be:</p>
          <pre class="screen">SELECT * FROM Users WHERE name = 'John' AND balance &gt; 1000</pre>
          <p>In this case "John" would be a parameter, and 1000 would be a parameter. If this rule has been specified and this string is used to interact with a database, then the string "John", and the value 1000  will be vetted to see if either is unsafe.</p>
          <div class="note" title="Note">
            <table border="0" summary="Note">
              <tr>
                <td rowspan="2" align="center" valign="top" width="25">
                  <img alt="[Note]" src="./images/icons//note.png" />
                </td>
                <th align="left"></th>
              </tr>
              <tr>
                <td align="left" valign="top">
                  <p>It is important to note that his rule provides protection only when these parameters are received via a http servlet. This means that the parameters must be received from the user through one of three calls in a class implementing javax.servlet.HttpServletRequest:</p>
                </td>
              </tr>
            </table>
          </div>
          <div class="itemizedlist">
            <ul class="itemizedlist">
              <li class="listitem">
getParameter( String parameterName )
</li>
              <li class="listitem">
getParameterMap()
</li>
              <li class="listitem">
getParameterValues( String parameterName )
</li>
            </ul>
          </div>
          <p>It is also worth noting that at this time this rule supports Oracle database only.</p>
          <p>Some high-level rule examples are:</p>
          <div class="itemizedlist">
            <ul class="itemizedlist">
              <li class="listitem">
Deny all incoming SQL parameters that are determined to be unsafe
</li>
              <li class="listitem">
The following example shows how a rule might be represented in the rules file.
</li>
            </ul>
          </div>
          <div class="example">
            <a id="idp34374144"></a>
            <p class="title">
              <b>Example 6.54. SQL Rule</b>
            </p>
            <div class="example-contents">
              <p>To deny any SQL parameters determined to be unsafe:</p>
              <pre class="screen">sql:database:oracle:deny:debug</pre>
            </div>
          </div>
          <br class="example-break" />
          <p><span class="strong"><strong>Rule Precedence</strong></span>
Only one SQL rule can be provided in a rules file. This means that this form of protection is either on or off.
For this reason the concept of precedence is not relevant to SQL rules.</p>
          <p><span class="strong"><strong>Duplicate Rules</strong></span>
Any attempt to specify more than one SQL rule will result in an error at file parsing.</p>
          <p></p>
        </div>
      </div>
    </div>
  </body>
</html>